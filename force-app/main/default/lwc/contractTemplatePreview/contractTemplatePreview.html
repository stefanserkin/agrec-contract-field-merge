<template>

    <lightning-spinner lwc:if={isLoading} alternative-text="Loading..." size="medium"></lightning-spinner>
    
    <template lwc:if={isShowPreview}>
        <lightning-button
            label="Back"
            icon-name="utility:back"
            icon-position="left"
            onclick={handleBack}
            class="slds-var-m-around_medium"
        ></lightning-button>
        
        <div>
            <lightning-formatted-rich-text
                value={previewContent}
                class="slds-var-m-around_medium"
            ></lightning-formatted-rich-text>
        </div>
    </template>

    <template lwc:else>

        <div class="slds-var-m-around_medium">
            <lightning-record-picker
                label="Select a Contract to Preview"
                placeholder="Search by Contract and Form Name or Account Name..."
                object-api-name="TREX1__Contract_and_Form__c"
                display-info={displayInfo}
                matching-info={matchingInfo}
                onchange={handleContractSelection}
                class="slds-var-m-around_medium"
            ></lightning-record-picker>
        </div>

        <template lwc:if={selectedContractId}>
            <lightning-layout>
                <lightning-layout-item size="6" padding="large">
                    <template lwc:if={selectedContractId}>
                        <h3 class="slds-text-heading_small">Selected Record Details</h3>
                        <lightning-record-view-form
                            object-api-name="TREX1__Contract_and_Form__c"
                            record-id={selectedContractId}
                        >
                            <lightning-output-field field-name={fields.id}> </lightning-output-field>
                            <lightning-output-field field-name={fields.name}> </lightning-output-field>
                            <lightning-output-field field-name={fields.status}> </lightning-output-field>
                            <lightning-output-field field-name={fields.contact}> </lightning-output-field>
                            <lightning-output-field field-name={fields.account}> </lightning-output-field>
                        </lightning-record-view-form>
                    </template>
                </lightning-layout-item>

                <lightning-layout-item size="6" padding="large">
                    <div lwc:if={selectedContractId} class="slds-var-m-around_medium slds-text-align_center">
                        <lightning-button
                            variant="brand"
                            label="Generate Preview"
                            icon-name="utility:document_preview"
                            onclick={handleShowPreview}
                        ></lightning-button>
                    </div>
                </lightning-layout-item>
            </lightning-layout>
        </template>
    </template>

</template>